generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model FirstBarangayFormSubmission {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId Int
  barangayId Int
  submittedAt DateTime?

  data        Json     // entire FirstBarangayForm from Pinia
  
  user       User     @relation(fields: [userId], references: [id])
  
  barangay       Barangay     @relation(fields: [barangayId], references: [id])
}

model SecondBarangayFormSubmission {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
userId Int
barangayId Int
  submittedAt DateTime?

  data        Json     // entire SecondBarangayForm from Pinia
  
  user       User     @relation(fields: [userId], references: [id])
  
  barangay       Barangay     @relation(fields: [barangayId], references: [id])
}

model ThirdBarangayFormSubmission {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
userId Int
barangayId Int
  submittedAt DateTime?

  data        Json     // entire ThirdBarangayForm from Pinia
  
  user       User     @relation(fields: [userId], references: [id])
  
  barangay       Barangay     @relation(fields: [barangayId], references: [id])
}

model BarangayFormProgress {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // identify WHO this progress belongs to
  // You can pick one:
  // or, if you prefer per user:
  userId      String @unique   // Supabase auth user id

  latestFormNumber       Int          // 1, 2, or 3
  latestFormSubmissionId String?      // id of the last submission (optional)
  latestFormSubmittedAt  DateTime?
}

model FirstRdanaSubmission {
  id                          String    @id @default(cuid())
  createdAt                   DateTime  @default(now())
  userId Int
  barangayId Int
  updatedAt                   DateTime  @updatedAt
  submittedAt                 DateTime?
  submittedByAuthId           String?
  profileMission              Json?
  initialImpact               Json?
  healthNutrition             Json?
  accessibilityPower          Json?
  communicationsEvac          Json?
  foodWaterSanitation         Json?
  lawOrderShelter             Json?
  livelihoodEngagementOverall Json?
  protectionEducation         Json?
  reliefSrr                   Json?
  submittedBy                 Json?
  
  user       User     @relation(fields: [userId], references: [id])
  
  barangay       Barangay     @relation(fields: [barangayId], references: [id])
}

model User {
  id                                      Int                                       @id @default(autoincrement())
  name                                    String
  password                                String
  status                                  String
  createdAt                               DateTime                                  @default(now())
  email                                   String                                    @unique
  role                                    Role
  barangayId                              Int?
  firstBarangayFormSubmission FirstBarangayFormSubmission[]
  secondBarangayFormSubmission  SecondBarangayFormSubmission[]
  thirdBarangayFormSubmission ThirdBarangayFormSubmission[]
  firstRdanaSubmission FirstRdanaSubmission[]
  damageAssessmentNeedAnalysisReport      DamageAssessmentNeedAnalysisReport[]
  floodRiskMap                            FLoodRiskMap[]
  generatedReports                        GeneratedReport[]
  rapidDamageAssessmentNeedAnalysisReport RapidDamageAssessmentNeedAnalysisReport[]
  barangay                                Barangay?                                 @relation(fields: [barangayId], references: [id])
}

model Barangay {
  id                                      Int                                       @id @default(autoincrement())
  name                                    String
  province String
  city String
  purok String
  population                              Int
  location                                String
  longitude                               Decimal
  latitude                                Decimal
  createdAt                               DateTime                                  @default(now())
  elevation                               Decimal
    firstBarangayFormSubmission FirstBarangayFormSubmission[]
  secondBarangayFormSubmission  SecondBarangayFormSubmission[]
  thirdBarangayFormSubmission ThirdBarangayFormSubmission[]
  firstRdanaSubmission FirstRdanaSubmission[]
  damageAssessmentNeedAnalysisReport      DamageAssessmentNeedAnalysisReport[]
  floodRiskMap                            FLoodRiskMap[]
  rapidDamageAssessmentNeedAnalysisReport RapidDamageAssessmentNeedAnalysisReport[]
  users                                   User[]
}

model EvacuationCenter {
  id               Int            @id @default(autoincrement())
  name             String
  capacity         Int
  latitude      Float
  longitude Float
  createdAt        DateTime       @default(now())
}

model GeneratedReport {
  id         Int      @id @default(autoincrement())
  reportType String
  filePath   String
  userId     Int
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
}

model FLoodRiskMap {
  id         Int      @id @default(autoincrement())
  riskLevel  String
  filePath   String
  barangayId Int
  userId     Int
  createdAt  DateTime @default(now())
  barangay   Barangay @relation(fields: [barangayId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model DamageAssessmentNeedAnalysisReport {
  id         Int      @id @default(autoincrement())
  status     String
  summary    String
  userId     Int
  barangayId Int
  createdAt  DateTime @default(now())
  barangay   Barangay @relation(fields: [barangayId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model RapidDamageAssessmentNeedAnalysisReport {
  id             Int      @id @default(autoincrement())
  status         String
  summary        String
  userId         Int
  barangayId     Int
  createdAt      DateTime @default(now())
  totalDamage    Int
  totalDisplaced Int
  barangay       Barangay @relation(fields: [barangayId], references: [id])
  user           User     @relation(fields: [userId], references: [id])
}

model DamageAssessmentReport {
  id                      Int                     @id @default(autoincrement())
  disasterType            String
  occurenceDate           DateTime
  reportSource            String
  reportDate              DateTime
  areasAffected           AreaAffected[]
  casualties              Casualties?
  communicationFacilities CommunicationFacility[]
  crops                   Crop[]
  damagedLifelines        DamagedLifeline[]
  damagedProperties       DamagedProperty[]
  electricalFacilities    ElectricalFacility[]
  evacueesReport          EvacueesReport?
  fishiries               Fisheries[]
  livestocks              LiveStock[]
  localActions            LocalAction?
  populationAffected      PopulationAffected?
  populationDisplaced     PopulationDisplaced?
  waterFacilities         WaterFacility[]
}

model AreaAffected {
  id       Int                    @id @default(autoincrement())
  name     String
  reportId Int
  report   DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model PopulationAffected {
  id       Int                    @id @default(autoincrement())
  families Int
  persons  Int
  children Int
  reportId Int                    @unique
  report   DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model PopulationDisplaced {
  id          Int                    @id @default(autoincrement())
  families    Int
  persons     Int
  infants     Int
  children    Int
  adolescents Int
  adults      Int
  reportId    Int                    @unique
  report      DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model Casualties {
  id       Int                    @id @default(autoincrement())
  dead     Int
  injured  Int
  missing  Int
  reportId Int                    @unique
  report   DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model DamagedProperty {
  id               Int                    @id @default(autoincrement())
  category         String
  totally          Int
  partially        Int
  estCostTotally   Float
  estCostPartially Float
  totalCost        Float
  reportId         Int
  report           DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model DamagedLifeline {
  id       Int                    @id @default(autoincrement())
  location String
  category String
  passable Boolean
  number   Int
  cost     Float
  reportId Int
  report   DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model CommunicationFacility {
  id          Int                    @id @default(autoincrement())
  location    String
  category    String
  operational Boolean
  number      Int
  cost        Float
  reportId    Int
  report      DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model ElectricalFacility {
  id          Int                    @id @default(autoincrement())
  location    String
  operational Boolean
  number      Int
  cost        Float
  reportId    Int
  report      DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model WaterFacility {
  id          Int                    @id @default(autoincrement())
  location    String
  operational Boolean
  number      Int
  cost        Float
  reportId    Int
  report      DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model Crop {
  id          Int                    @id @default(autoincrement())
  cropType    String
  areaDamaged Float
  lossesTons  Float
  lossesValue Float
  reportId    Int
  report      DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model Fisheries {
  id          Int                    @id @default(autoincrement())
  type        String
  number      Int
  lossesTons  Float?
  lossesValue Float
  reportId    Int
  report      DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model LiveStock {
  id         Int                    @id @default(autoincrement())
  animalType String
  heads      Int
  pesoValue  Float
  reportId   Int
  report     DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model LocalAction {
  id                          Int                    @id @default(autoincrement())
  respondersInvolved          String
  assetsDeployed              String
  affectedPopulationFamilies  Int
  affectedPopulationPersons   Int
  displacedPopulationFamilies Int
  displacedPopulationPersons  Int
  displacedInfants            Int
  displacedChildren           Int
  displacedAdults             Int
  extentOfAssistance          String
  reportId                    Int                    @unique
  report                      DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model EvacueesReport {
  id               Int                    @id @default(autoincrement())
  date             DateTime
  barangay         String
  typeOfDisaster   String
  totalEvacCenters Int
  totalFamilies    Int
  totalPerson      Int
  preparedBy       String
  notedBy          String
  reportId         Int                    @unique
  report           DamageAssessmentReport @relation(fields: [reportId], references: [id])
}

model RapidDamageAssessmentReport {
  id                     Int                      @id @default(autoincrement())
  operation              String
  eventype               String
  eventDate              DateTime
  region                 String
  province               String
  city                   String
  barangay               String
  sitioPurok             String?
  gpsCoords              String?
  reportDate             DateTime
  accessibility          Accessibility?
  communication          Communication?
  communityEngagement    CommunityEngagement?
  demographics           Demographics?
  eduation               Education?
  health                 Health?
  livelihood             Livelihood?
  localAuthority         LocalAuthority?
  nutrition              Nutrition?
  overallAssessment      OverallAssessment?
  powerAndElectricity    PowerAndElectricity?
  protection             Protection?
  sanitation             Sanitation?
}

model LocalAuthority {
  id            Int                         @id @default(autoincrement())
  name          String
  age           Int?
  office        String?
  designation   String?
  phone         String?
  email         String?
  rapidReportId Int                         @unique
  rapidReport   RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Demographics {
  id                                 Int                         @id @default(autoincrement())
  affectedFamilies                   Int
  affectedPerson                     Int
  displacedFamiliesInsideEvacCenter  Int
  displacedFamiliesOutsideEvacCenter Int
  displacedPersonsInsideEvacCenter   Int
  displacedPersonOutsideEvacCenter   Int
  affectedChildren0to2               Int
  affectedChildren3to5               Int
  affectedChildren6to12              Int
  affectedChildren13to17             Int
  pwd                                Int
  elderly                            Int
  missingMale                        Int
  missingFemale                      Int
  injuredMale                        Int
  injuredFemale                      Int
  deadMale                           Int
  deadFemale                         Int
  totalDead                          Int
  rapidReportId                      Int                         @unique
  rapidReport                        RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Accessibility {
  id             Int                         @id @default(autoincrement())
  isAccessible   Boolean
  transportModes String[]
  damagedRoads   Boolean
  needs          String[]
  rapidReportId  Int                         @unique
  rapidReport    RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model PowerAndElectricity {
  id            Int                         @id @default(autoincrement())
  status        String
  daysFuelStock Int?
  urgentNeed    String[]
  rapidReportId Int                         @unique
  rapidReport   RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Communication {
  id                  Int                         @id @default(autoincrement())
  telecomServices     String[]
  operationalServices String[]
  alternativeComm     String[]
  urgentNeeds         String[]
  rapidReportId       Int                         @unique
  rapidReport         RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model EvacuationCenterDetail {
  id            Int                         @id @default(autoincrement())
  name          String
  address       String?
  gpsCoords     String?
  families      Int
  persons       Int
}

model Sanitation {
  id            Int                         @id @default(autoincrement())
  facilities    String[]
  immidiateNeed String[]
  rapidReportId Int                         @unique
  rapidReport   RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Health {
  id              Int                         @id @default(autoincrement())
  hasAccess       Boolean
  facilities      String[]
  mainConcerns    String[]
  levelOfSupplies String
  urgentNeed      String[]
  rapidReportId   Int                         @unique
  rapidReport     RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Nutrition {
  id                Int                         @id @default(autoincrement())
  breastfeedingInfo Boolean
  milkProductsDist  Boolean
  interventions     String[]
  urgentNeeds       String[]
  rapidReportId     Int                         @unique
  rapidReport       RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Protection {
  id                   Int                         @id @default(autoincrement())
  violenceReported     Boolean
  vulnerableGroups     String[]
  protectionMechanisms String[]
  urgentNeeds          String[]
  rapidReportId        Int                         @unique
  rapidReport          RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Education {
  id                     Int                         @id @default(autoincrement())
  classroomsAsEvacCenter Int
  childrenInEvacCenter   Int
  destroyedClassrooms    Int
  damagedClassrooms      Int
  urgentNeeds            String[]
  rapidReportId          Int                         @unique
  rapidReport            RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model Livelihood {
  id            Int                         @id @default(autoincrement())
  mainSource    String
  urgentNeeds   String[]
  rapidReportId Int                         @unique
  rapidReport   RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model CommunityEngagement {
  id            Int                         @id @default(autoincrement())
  receivesInfo  Boolean
  infoNeeds     String[]
  sources       String[]
  rapidReportId Int                         @unique
  rapidReport   RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

model OverallAssessment {
  id            Int                         @id @default(autoincrement())
  situation     String
  risks         String[]
  rapidReportId Int                         @unique
  rapidReport   RapidDamageAssessmentReport @relation(fields: [rapidReportId], references: [id])
}

enum Role {
  MDRRMO
  BARANGAY_OFFICIAL
  ADMIN
}
